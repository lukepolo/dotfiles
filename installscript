#!/bin/bash

# Hide "last login" line when starting a new terminal session
touch $HOME/.hushlogin

#################################################################
### GIT
#################################################################

# global gitigore
ln -s $HOME/.dotfiles/shell/.global-gitignore $HOME/.global-gitignore
ln -s $HOME/.dotfiles/shell/.gitconfig $HOME/.gitconfig
git config --global core.excludesfile $HOME/.global-gitignore
clear

# global git config setup
git config --global core.autocrlf true

#################################################################
### ZSH
#################################################################

echo 'install oh-my-zhs'
echo '-----------------'
rm -rf $HOME/.oh-my-zsh
curl -L http://install.ohmyz.sh | sh
git clone https://github.com/zsh-users/zsh-autosuggestions ~/.zsh/zsh-autosuggestions
git clone https://github.com/denysdovhan/spaceship-prompt.git "$ZSH_CUSTOM/themes/spaceship-prompt"

#symlink zsh prefs
rm $HOME/.zshrc
ln -s $HOME/.dotfiles/shell/.zshrc $HOME/.zshrc
ln -s "$ZSH_CUSTOM/themes/spaceship-prompt/spaceship.zsh-theme" "$ZSH_CUSTOM/themes/spaceship.zsh-theme"

#################################################################
### Homebrew
#################################################################

echo 'install homebrew'
echo '----------------'
echo install homebrew
rm -rf /usr/local/Cellar /usr/local/.git && brew cleanup
ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"

echo 'Install brew-cask'
echo '-----------------'
brew tap caskroom/cask
brew install brew-cask

#################################################################
### PHP
#################################################################

echo 'install php'
echo '------------'
brew install php@7.2

echo 'Install xdebug'
echo '--------------'
pecl install xdebug

#################################################################
### Composer
#################################################################

echo 'install composer'
echo '----------------'
cd ~/.dotfiles
brew install composer

#################################################################
### Redis
#################################################################

echo 'install redis'
echo '------------'
brew install redis
brew services start redis

#################################################################
### Valet
#################################################################

echo 'install laravel valet'
echo '---------------------'
composer global require laravel/valet
valet install

#################################################################
### MySQL
#################################################################

echo 'install mysql'
echo '---------------'
brew install mysql
brew services start mysql

#################################################################
### Sequel Pro
#################################################################
brew cask install homebrew/cask-versions/sequel-pro-nightly

#################################################################
### Mongo
#################################################################

echo 'install mongo'
echo '---------------'
brew install mongo
brew services start mongodb

#################################################################
### Node
#################################################################

curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.11/install.sh | bash

nvm install 10.15.0

git clone https://github.com/lukechilds/zsh-nvm ~/.oh-my-zsh/custom/plugins/zsh-nvm

# install file watch (needed for watching phpunit tests)
echo 'install onchange'
echo '----------------'
npm install -g onchange

#################################################################
### Docker
#################################################################

echo 'install docker'
echo '------------'
brew install docker docker-machine
brew services start docker-machine

# create the vm
docker-machine create -d virtualbox dev

#################################################################
### Random
#################################################################

echo 'install dos2unix'
echo '------------'
brew install dos2unix

echo 'Install imagemagick'
echo '-------------------'
brew install imagemagick

echo 'Install imagick'
echo '---------------'
pecl install imagick

#################################################################
### Tidbits
#################################################################

echo 'fixing ZSH'
echo '------------'

cd ~/.oh-my-zsh

git config core.autocrlf input
git rm --cached -r .
git reset --hard

dos2unix ~/.zsh/zsh-autosuggestions/zsh-autosuggestions.zsh
dos2unix ~/.oh-my-zsh/custom/plugins/zsh-nvm/zsh-nvm.plugin.zsh
find ~/.oh-my-zsh/custom/themes/spaceship-prompt/. -type f -print0 | xargs -0 dos2unix

echo '++++++++++++++++++++++++++++++'
echo '++++++++++++++++++++++++++++++'
echo 'all done'

echo '++++++++++++++++++++++++++++++'
echo 'Some optional tidbits'

echo '1. set some sensible os x defaults by running: $HOME/.dotfiles/osx/set-defaults.sh'
echo '2. make a .dotfiles-custom/shell/.(exports,aliases,functions,zshrc) for your personal commands'

echo '++++++++++++++++++++++++++++++'
echo 'Sometimes ZSH has issues with line endings after installing. Just copy the error and paste into their issues https://github.com/robbyrussell/oh-my-zsh/issues'

echo '++++++++++++++++++++++++++++++'
echo 'Please report issues!'
